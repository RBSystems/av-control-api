= Complete OS Setup Guide

We use CouchDB as the database for our solution. Apache CouchDB is an open-source document-oriented NoSQL database
that uses JSON documents to store data. For more information about CuchDB specifically please refer to their http://docs.couchdb.org/en/stable/intro/index.html[documentation].
 
Within CouchDB there are five important tables that are used throughout our solution:

. devices
. device_type
. ui_config
. rooms
. bldgs
. room_config

This guide will outline each of the tables above, their purpose, what data is being stored, and how it is used within our AV solution.

=== devices
The devices table contains all of the necessary information for the device you are using, this includes the device name, device type, 
IP address of the device, and the roles or capabilities the device has. These fields will be described in greater detail down below.

Sample CouchDB Entry for Raspberry Pi device:
----
{
  "_id": "BLDG-RM-CP1", // <1>
  "_rev": "1-1d3b5f66d895b3bb1e9c7e5671488ea1", // <2>
  "name": "CP1", // <3>
  "address": "BLDG-RM-CP1.youruniversity.edu", // <4>
  "description": "BLDG-RM", // <5>
  "display_name": "BLDG-RM", // <6>
  "type": { // <7>
    "_id": "Pi3" 
  },
  "roles": [ // <8>
    {
      "_id": "ControlProcessor",
      "description": "ControlProcessor"
    },
    {
      "_id": "EventRouter",
      "description": "EventRouter"
    },
    {
      "_id": "Touchpanel",
      "description": "Touchpanel"
    }
  ],
  "ports": [] // <9>
}
----
<1> "_id": Unique identifier of JSON Document in CouchDB. An ID is automatically generated when making a new document but can be changed to something 
more readable like "BLDG-RM-CP1" (CP - Control Processor) or any ID of your choice.
<2> "_rev": Revision token that is automatically generated by CouchDB. Do not worry about changing this, Couch simply uses this token
for optimistic-concurrency detection. For more information about this field refer to CouchDB's http://guide.couchdb.org/draft/consistency.html#locking[documentation]
<3> "name": Name of the device.
<4> "address": This is the IP address of the device. if you have DNS resolution set up in your organization you can assign a name to the IP address
abnd use the name as shown in the above example, or you can simply put in the IP address (i.e. 10.254.254.254).
<5> "description": Description of the device, this field is for your benefit to include any descriptive information you want stored.
<6> "display_name": The name that you want displayed for the device.
<7> "type": Type refers to the device type. The "_id" maps back to a document in the device_type database. This will be explained in greater
detail in the device_type section.
<8> "roles": A list of roles that the device has. A complete list of roles and how they relate to each device can be found xref:roles.adoc[here].
<9> "ports": A list of the ports on the device. A Pi does not have any ports so the array is empty. This will make more sense in the next device example.

Sample CouchDB Entry for Sony XBR device:
----
{
  "_id": "HBLL-2231-D2", // <1>
  "_rev": "1-de858339580870273735386f7a4a218e", // <1>
  "name": "D2", // <1>
  "address": "10.66.21.56", // <1>
  "description": "Display 2", // <1>
  "display_name": "Display 2",// <1>
  "type": { // <1>
    "_id": "SonyXBR"
  },
  "roles": [ // <1>
    {
      "_id": "AudioOut",
      "description": "AudioOut"
    },
    {
      "_id": "VideoOut",
      "description": "VideoOut"
    }
  ],
  "ports": [ // <2>
    {
      "_id": "hdmi!2",
      "friendly_name": "SonyTv HDMI input 2",
      "source_device": "HBLL-2231-SW1",
      "destination_device": "HBLL-2231-D2",
      "description": "SonyTv HDMI input 2"
    }
  ]
}
----
<1> All of these fields have been explained i nthe above example
<2> "ports": A list of the ports on the device. Each input for the Sony Display that is used will be listed in this array.
* "_id": ID of the port, "hdmi!2" is the format used in communicating with the Sony XBR display.
* "friendly_name": What you want the input to be named on the UI
* "source_device": The source device of the input coming into the TV (i.e. vieo switcher, computer, HDMI Pass through etc.).
This is the ID of the document for the source device.
* "description": A description of the port, this field is for your benefit to include any descriptive information you want stored.

=== device_type
The device_type database contains information about a type of devices (whereas the devices database contains info about a specific instance of a device).
This Database is important because it contains info on what commands are available for the device, and what mcroservices and endpoints are used
in the use of these commands.

Sample CouchDB Entry for Raspberry Pi device-type:
----
{
  "_id": "Pi3",
  "_rev": "9-9a60c267a9cad92da3fb85p35cbb757d",
  "description": "A Raspberry Pi 3",
  "display_name": "Pi",
  "default-name": "CP",
  "default-icon": "video_label",
  "default-address": "[BLDG]-[ROOM]-[NAME].youruniversity.edu",
  "roles": [
    {
      "_id": "ControlProcessor",
      "description": "Acts as a device to control the AV-API in a room"
    },
    {
      "_id": "Touchpanel",
      "description": "A device with a touchscreen interface"
    },
    {
      "_id": "EventRouter",
      "description": "Acts as a device that routes events through the room to other devices"
    }
  ],
  "commands": [
    {
      "_id": "GenericPassthroughADCP",
      "description": "GenericPassthroughADCP",
      "microservice": {
        "_id": "generic-gateway-Adcp",
        "description": "used to serialize requests to and ADCP device",
        "address": "http://:gateway:8012"
      },
      "endpoint": {
        "_id": "Generic Gateway",
        "description": "A generic Gateway for use in base case where microservice exists outside of the pi issuing the requests. ",
        "path": "/:path"
      },
      "priority": 1
    }
  ]
}
----
=== ui_config
=== rooms
=== bldgs
=== room_config